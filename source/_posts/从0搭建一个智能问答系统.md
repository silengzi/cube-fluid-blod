---
title: ä»0æ­å»ºä¸€ä¸ªæ™ºèƒ½é—®ç­”ç³»ç»Ÿ
date: 2025-07-18T01:48:00.000Z
tags: 
  - python
  - poetry
  - FastAPI
  - LangChain
  - å·¥ç¨‹åŒ–
  - é¡¹ç›®åˆå§‹åŒ–
  - æ™ºèƒ½é—®ç­”

---


æ‘˜è¦...


## æŠ€æœ¯é€‰å‹

| æ¨¡å—       | æŠ€æœ¯æ ˆ                     |
|------------|----------------------------|
| Python ç‰ˆæœ¬ | `pyenv` + `poetry` ç®¡ç†   |
| è™šæ‹Ÿç¯å¢ƒ   | `poetry` è‡ªåŠ¨éš”ç¦»         |
| Web æ¡†æ¶   | `FastAPI` + `uvicorn`     |
| AI é—®ç­”    | `LangChain` + `OpenAI SDK`|

---

## é¡¹ç›®ç»“æ„

```txt
  ai-qa-bot/
  â”œâ”€â”€ app/
  â”‚ â”œâ”€â”€ main.py # FastAPI æœåŠ¡å…¥å£
  â”‚ â”œâ”€â”€ api/
  â”‚ â”‚ â””â”€â”€ chat.py # /chat æ¥å£å®šä¹‰
  â”‚ â”œâ”€â”€ services/
  â”‚ â”‚ â””â”€â”€ qa_service.py # LangChain å°è£…
  â”‚ â””â”€â”€ models/
  â”‚ â””â”€â”€ message.py # è¯·æ±‚/å“åº”æ¨¡å‹
  â”œâ”€â”€ tests/ # æµ‹è¯•ä»£ç 
  â”œâ”€â”€ .env # OpenAI å¯†é’¥
  â”œâ”€â”€ pyproject.toml # Poetry é…ç½®
  â””â”€â”€ README.md # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

---

## é…ç½®ç¯å¢ƒ

ä½¿ç”¨ `pyenv` ç®¡ç† python ç‰ˆæœ¬ã€‚

```bash
pyenv install 3.11.9
pyenv global 3.11.9
```

---

## é¡¹ç›®åˆå§‹åŒ–

#### 1. å®‰è£… poetry ( windows )

ä½¿ç”¨ `poetry` åˆ›å»ºå’Œç®¡ç†é¡¹ç›®ï¼Œæ¯”å¦‚è™šæ‹Ÿç¯å¢ƒã€å®‰è£…ä¾èµ–ç­‰ã€‚
1. æ‰“å¼€ PowerShell
2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```powershell
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -
```
è¦æ±‚ï¼šç³»ç»Ÿå·²å®‰è£… Pythonï¼Œä¸” python å‘½ä»¤å¯ç”¨

#### 2. é…ç½®ç¯å¢ƒå˜é‡

ä½¿ç”¨ `poetry --version` éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœªæˆåŠŸï¼Œåˆ™éœ€è¦æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡ã€‚
Poetry å®‰è£…åœ¨ç”¨æˆ·ç›®å½•ä¸‹ï¼Œé»˜è®¤è·¯å¾„æ˜¯ï¼š
```
C:\Users\<ä½ çš„ç”¨æˆ·å>\AppData\Roaming\Python\Scripts
```


åˆ›å»ºé¡¹ç›® & å®‰è£…ä¾èµ–

---

## å¯åŠ¨ FastAPI æœåŠ¡

```bash
poetry run uvicorn app.main:app --reload
```

è®¿é—®æ¥å£æ–‡æ¡£ï¼š
http://127.0.0.1:8000/docs

---

## ç¤ºä¾‹ APIï¼šæµå¼é—®ç­”æ¥å£

#### POST /chat

```json
è¯·æ±‚ä½“ï¼š
{
  "message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä½ è‡ªå·±"
}
```
è¿”å›ç±»å‹ï¼šStreamingResponseï¼ˆé€æ­¥è¿”å›å›ç­”ï¼‰

---

## æ ¸å¿ƒä»£ç è¯´æ˜

#### app/main.py
```python
from fastapi import FastAPI
from app.api import chat
from dotenv import load_dotenv

load_dotenv()
app = FastAPI()
app.include_router(chat.router)
```

#### app/api/chat.py

```python
from fastapi import APIRouter, Request
from fastapi.responses import StreamingResponse
from app.services.qa_service import get_chat_response
from app.models.message import ChatRequest

router = APIRouter()

@router.post("/chat")
async def chat(req: Request):
    data = await req.json()
    prompt = data.get("message", "")
    
    def stream():
        for chunk in get_chat_response(prompt):
            yield chunk
    
    return StreamingResponse(stream(), media_type="text/plain")
```

#### app/services/qa_service.py

```python
from langchain.chat_models import ChatOpenAI
from langchain.chains import ConversationChain
from langchain.memory import ConversationBufferMemory
import os

llm = ChatOpenAI(
    temperature=0.7,
    streaming=False,
    openai_api_key=os.getenv("OPENAI_API_KEY")
)

memory = ConversationBufferMemory()
conversation = ConversationChain(llm=llm, memory=memory)

def get_chat_response(prompt: str):
    yield "ğŸ¤– æ­£åœ¨æ€è€ƒ...\n"
    response = conversation.predict(input=prompt)
    yield response
```

#### app/models/message.py

```python
from pydantic import BaseModel

class ChatRequest(BaseModel):
    message: str
```




![åŠ æ²¹](https://silengzi.github.io/cube-fluid-blod/images/006APoFYly8h5mmvdv4zyg307n07nu10.gif)